/*!
 * maptalks.mapboxgl v0.3.0
 * LICENSE : MIT
 * (c) 2016-2017 maptalks.org
 */
/*!
 * requires maptalks@>=0.29.0 
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("maptalks"),require("mapboxgl")):"function"==typeof define&&define.amd?define(["exports","maptalks","mapboxgl"],e):e(t.maptalks=t.maptalks||{},t.maptalks,t.mapboxgl)}(this,function(t,e,n){"use strict";function o(t,e){for(var n=Object.getOwnPropertyNames(e),o=0;o<n.length;o++){var i=n[o],r=Object.getOwnPropertyDescriptor(e,i);r&&r.configurable&&void 0===t[i]&&Object.defineProperty(t,i,r)}return t}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):o(t,e))}n=n&&n.hasOwnProperty("default")?n.default:n;var s={renderer:"dom",container:"back",glOptions:{style:"mapbox://styles/mapbox/streets-v9"}},p=function(t){function e(){return i(this,e),r(this,t.apply(this,arguments))}return a(e,t),e.fromJSON=function(t){return t&&"MapboxglLayer"===t.type?new e(t.id,t.options):null},e.prototype.getGlMap=function(){var t=this._getRenderer();return t?t.glmap:null},e.prototype.toJSON=function(){return{type:this.getJSONType(),id:this.getId(),options:this.config()}},e}(e.Layer);p.mergeOptions(s),p.registerJSONType("MapboxglLayer"),p.registerRenderer("dom",function(){function t(e){i(this,t),this.layer=e}return t.prototype.getMap=function(){return this.layer?this.layer.getMap():null},t.prototype.show=function(){this._container&&(this.render(),this._show())},t.prototype.hide=function(){this._container&&(this._hide(),this.clear())},t.prototype.remove=function(){delete this.layer,this.glmap&&this.glmap.remove(),this._container&&e.DomUtil.removeDomNode(this._container),delete this._container,delete this.glmap},t.prototype.clear=function(){this._container&&(this._container.innerHTML="")},t.prototype.setZIndex=function(t){this._zIndex=t,this._container&&(this._container.style.zIndex=t)},t.prototype.needToRedraw=function(){var t=this.getMap(),e=t._getRenderer();return t.isInteracting()||e&&e.isViewChanged()},t.prototype.render=function(){var t=this;if(this._container||this._createLayerContainer(),!this.glmap){var o=this.getMap(),i=o.getCenter(),r=e.Util.extend({},this.layer.options.glOptions,{container:this._container,center:new n.LngLat(i.x,i.y),zoom:o.getZoom()-1});this.glmap=new n.Map(r),this.glmap.on("load",function(){t.layer.fire("layerload")})}this._syncMap()},t.prototype.drawOnInteracting=function(t){var e=this.getMap();if(this.glmap&&e)if(e.isZooming()&&t.origin){var o=t.origin;o=e.containerPointToCoordinate(o);var i={around:o=new n.LngLat(o.x,o.y),duration:0};this.glmap.zoomTo(e.getZoom()-1,i)}else this._syncMap()},t.prototype.getEvents=function(){return{resize:this.onResize}},t.prototype.onResize=function(){this._resize()},t.prototype._createLayerContainer=function(){var t=this._container=e.DomUtil.createEl("div","maptalks-mapboxgllayer");t.style.cssText="position:absolute;",this._resize(),this._zIndex&&(t.style.zIndex=this._zIndex),("front"===this.layer.options.container?this.getMap()._panels.frontStatic:this.getMap()._panels.backStatic).appendChild(t)},t.prototype._resize=function(){var t=this._container;if(t){var e=this.getMap().getSize();t.style.width=e.width+"px",t.style.height=e.height+"px",this.glmap&&this.glmap.resize()}},t.prototype._show=function(){this._container.style.display=""},t.prototype._hide=function(){this._container.style.display="none"},t.prototype._syncMap=function(){var t=this.getMap();if(this.glmap&&t){var e=t.getCenter(),o={center:new n.LngLat(e.x,e.y),zoom:t.getZoom()-1,bearing:t.getBearing(),pitch:t.getPitch()};this.glmap.jumpTo(o)}},t}()),t.MapboxglLayer=p,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.mapboxgl v0.3.0, requires maptalks@>=0.29.0.")});