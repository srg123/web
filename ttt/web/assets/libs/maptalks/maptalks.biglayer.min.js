/*!
 * maptalks.biglayer v0.4.0
 * LICENSE : MIT
 * (c) 2016-2018 maptalks.org
 */
/*!
 * requires maptalks@>=0.37.0 
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],e):e(t.maptalks=t.maptalks||{},t.maptalks)}(this,function(t,e){"use strict";function r(){var t=new Float32Array(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function n(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function i(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function a(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],l=e[5],h=e[6],u=e[7],f=e[8],c=e[9],p=e[10],v=e[11],y=e[12],g=e[13],d=e[14],_=e[15],x=r[0],m=r[1],b=r[2],A=r[3];return t[0]=x*n+m*s+b*f+A*y,t[1]=x*i+m*l+b*c+A*g,t[2]=x*a+m*h+b*p+A*d,t[3]=x*o+m*u+b*v+A*_,x=r[4],m=r[5],b=r[6],A=r[7],t[4]=x*n+m*s+b*f+A*y,t[5]=x*i+m*l+b*c+A*g,t[6]=x*a+m*h+b*p+A*d,t[7]=x*o+m*u+b*v+A*_,x=r[8],m=r[9],b=r[10],A=r[11],t[8]=x*n+m*s+b*f+A*y,t[9]=x*i+m*l+b*c+A*g,t[10]=x*a+m*h+b*p+A*d,t[11]=x*o+m*u+b*v+A*_,x=r[12],m=r[13],b=r[14],A=r[15],t[12]=x*n+m*s+b*f+A*y,t[13]=x*i+m*l+b*c+A*g,t[14]=x*a+m*h+b*p+A*d,t[15]=x*o+m*u+b*v+A*_,t}function o(t,e,r){var n,i,a,o,s,l,h,u,f,c,p,v,y=r[0],g=r[1],d=r[2];return e===t?(t[12]=e[0]*y+e[4]*g+e[8]*d+e[12],t[13]=e[1]*y+e[5]*g+e[9]*d+e[13],t[14]=e[2]*y+e[6]*g+e[10]*d+e[14],t[15]=e[3]*y+e[7]*g+e[11]*d+e[15]):(n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],l=e[5],h=e[6],u=e[7],f=e[8],c=e[9],p=e[10],v=e[11],t[0]=n,t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=l,t[6]=h,t[7]=u,t[8]=f,t[9]=c,t[10]=p,t[11]=v,t[12]=n*y+s*g+f*d+e[12],t[13]=i*y+l*g+c*d+e[13],t[14]=a*y+h*g+p*d+e[14],t[15]=o*y+u*g+v*d+e[15]),t}function s(t,e,r){var n=r[0],i=r[1],a=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function l(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[4],o=e[5],s=e[6],l=e[7],h=e[8],u=e[9],f=e[10],c=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*i+h*n,t[5]=o*i+u*n,t[6]=s*i+f*n,t[7]=l*i+c*n,t[8]=h*i-a*n,t[9]=u*i-o*n,t[10]=f*i-s*n,t[11]=c*i-l*n,t}function h(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[0],o=e[1],s=e[2],l=e[3],h=e[4],u=e[5],f=e[6],c=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i+h*n,t[1]=o*i+u*n,t[2]=s*i+f*n,t[3]=l*i+c*n,t[4]=h*i-a*n,t[5]=u*i-o*n,t[6]=f*i-s*n,t[7]=c*i-l*n,t}function u(t,e,r,n,i){var a=1/Math.tan(e/2),o=1/(n-i);return t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+n)*o,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*n*o,t[15]=0,t}function f(t,e,r,n){var a,o,s,l,h,u,f,c,p,v,y=e[0],g=e[1],d=e[2],_=n[0],x=n[1],m=n[2],b=r[0],A=r[1],w=r[2];return 0===Math.abs(y-b)&&0===Math.abs(g-A)&&0===Math.abs(d-w)?i(t):(f=y-b,c=g-A,p=d-w,v=1/Math.sqrt(f*f+c*c+p*p),f*=v,c*=v,p*=v,a=x*p-m*c,o=m*f-_*p,s=_*c-x*f,(v=Math.sqrt(a*a+o*o+s*s))?(a*=v=1/v,o*=v,s*=v):(a=0,o=0,s=0),l=c*s-p*o,h=p*a-f*s,u=f*o-c*a,(v=Math.sqrt(l*l+h*h+u*u))?(l*=v=1/v,h*=v,u*=v):(l=0,h=0,u=0),t[0]=a,t[1]=l,t[2]=f,t[3]=0,t[4]=o,t[5]=h,t[6]=c,t[7]=0,t[8]=s,t[9]=u,t[10]=p,t[11]=0,t[12]=-(a*y+o*g+s*d),t[13]=-(l*y+h*g+u*d),t[14]=-(f*y+c*g+p*d),t[15]=1,t)}function c(){var t=new Float32Array(3);return t[0]=0,t[1]=0,t[2]=0,t}function p(t,e,r){var n=new Float32Array(3);return n[0]=t,n[1]=e,n[2]=r,n}function v(t,e){var r=e[0],n=e[1],i=e[2],a=r*r+n*n+i*i;return a>0&&(a=1/Math.sqrt(a),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a),t}function y(){var t=new Float32Array(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function g(t,e){for(var r=Object.getOwnPropertyNames(e),n=0;n<r.length;n++){var i=r[n],a=Object.getOwnPropertyDescriptor(e,i);a&&a.configurable&&void 0===t[i]&&Object.defineProperty(t,i,a)}return t}function d(t){return t.getMaxNativeZoom()/2}function _(t,e){switch(e){case"source-over":t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case"destination-over":t.blendFunc(t.ONE_MINUS_DST_ALPHA,t.ONE);break;case"source-in":t.blendFunc(t.DST_ALPHA,t.ZERO);break;case"destination-in":t.blendFunc(t.ZERO,t.SRC_ALPHA);break;case"source-out":t.blendFunc(t.ONE_MINUS_DST_ALPHA,t.ZERO);break;case"destination-out":t.blendFunc(t.ZERO,t.ONE_MINUS_SRC_ALPHA);break;case"source-atop":t.blendFunc(t.DST_ALPHA,t.ONE_MINUS_SRC_ALPHA);break;case"destination-atop":t.blendFunc(t.ONE_MINUS_DST_ALPHA,t.SRC_ALPHA);break;case"xor":t.blendFunc(t.ONE_MINUS_DST_ALPHA,t.ONE_MINUS_SRC_ALPHA);break;case"lighter":t.blendFunc(t.ONE,t.ONE);break;case"copy":t.blendFunc(t.ONE,t.ZERO);break;case"destination":t.blendFunc(t.ZERO,t.ONE);break;default:t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA)}}function x(t,e){this.x=t,this.y=e}function m(t,e,r){r=r||2;var n=e&&e.length,i=n?e[0]*r:t.length,a=b(t,0,i,r,!0),o=[];if(!a)return o;var s,l,h,u,f,c,p;if(n&&(a=C(t,e,a,r)),t.length>80*r){s=h=t[0],l=u=t[1];for(var v=r;v<i;v+=r)f=t[v],c=t[v+1],f<s&&(s=f),c<l&&(l=c),f>h&&(h=f),c>u&&(u=c);p=Math.max(h-s,u-l)}return w(a,o,r,s,l,p),o}function b(t,e,r,n,i){var a,o;if(i===G(t,e,r,n)>0)for(a=e;a<r;a+=n)o=q(a,t[a],t[a+1],o);else for(a=r-n;a>=e;a-=n)o=q(a,t[a],t[a+1],o);return o&&I(o,o.next)&&(W(o),o=o.next),o}function A(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!I(n,n.next)&&0!==D(n.prev,n,n.next))n=n.next;else{if(W(n),(n=e=n.prev)===n.next)return null;r=!0}}while(r||n!==e);return e}function w(t,e,r,n,i,a,o){if(t){!o&&a&&k(t,n,i,a);for(var s,l,h=t;t.prev!==t.next;)if(s=t.prev,l=t.next,a?E(t,n,i,a):S(t))e.push(s.i/r),e.push(t.i/r),e.push(l.i/r),W(t),t=l.next,h=l.next;else if((t=l)===h){o?1===o?w(t=M(t,e,r),e,r,n,i,a,2):2===o&&R(t,e,r,n,i,a):w(A(t),e,r,n,i,a,1);break}}}function S(t){var e=t.prev,r=t,n=t.next;if(D(e,r,n)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(N(e.x,e.y,r.x,r.y,n.x,n.y,i.x,i.y)&&D(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function E(t,e,r,n){var i=t.prev,a=t,o=t.next;if(D(i,a,o)>=0)return!1;for(var s=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,l=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,h=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,u=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,f=L(s,l,e,r,n),c=L(h,u,e,r,n),p=t.nextZ;p&&p.z<=c;){if(p!==t.prev&&p!==t.next&&N(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&D(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(p=t.prevZ;p&&p.z>=f;){if(p!==t.prev&&p!==t.next&&N(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&D(p.prev,p,p.next)>=0)return!1;p=p.prevZ}return!0}function M(t,e,r){var n=t;do{var i=n.prev,a=n.next.next;!I(i,a)&&V(i,n,n.next,a)&&j(i,a)&&j(a,i)&&(e.push(i.i/r),e.push(n.i/r),e.push(a.i/r),W(n),W(n.next),n=t=a),n=n.next}while(n!==t);return n}function R(t,e,r,n,i,a){var o=t;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&U(o,s)){var l=Z(o,s);return o=A(o,o.next),l=A(l,l.next),w(o,e,r,n,i,a),void w(l,e,r,n,i,a)}s=s.next}o=o.next}while(o!==t)}function C(t,e,r,n){var i,a,o,s=[];for(i=0,a=e.length;i<a;i++)(o=b(t,e[i]*n,i<a-1?e[i+1]*n:t.length,n,!1))===o.next&&(o.steiner=!0),s.push(O(o));for(s.sort(F),i=0;i<s.length;i++)B(s[i],r),r=A(r,r.next);return r}function F(t,e){return t.x-e.x}function B(t,e){if(e=T(t,e)){var r=Z(e,t);A(r,r.next)}}function T(t,e){var r,n=e,i=t.x,a=t.y,o=-1/0;do{if(a<=n.y&&a>=n.next.y){var s=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>o){if(o=s,s===i){if(a===n.y)return n;if(a===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!r)return null;if(i===o)return r.prev;var l,h=r,u=r.x,f=r.y,c=1/0;for(n=r.next;n!==h;)i>=n.x&&n.x>=u&&N(a<f?i:o,a,u,f,a<f?o:i,a,n.x,n.y)&&((l=Math.abs(a-n.y)/(i-n.x))<c||l===c&&n.x>r.x)&&j(n,t)&&(r=n,c=l),n=n.next;return r}function k(t,e,r,n){var i=t;do{null===i.z&&(i.z=L(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,P(i)}function P(t){var e,r,n,i,a,o,s,l,h=1;do{for(r=t,t=null,a=null,o=0;r;){for(o++,n=r,s=0,e=0;e<h&&(s++,n=n.nextZ);e++);for(l=h;s>0||l>0&&n;)0===s?(i=n,n=n.nextZ,l--):0!==l&&n?r.z<=n.z?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,l--):(i=r,r=r.nextZ,s--),a?a.nextZ=i:t=i,i.prevZ=a,a=i;r=n}a.nextZ=null,h*=2}while(o>1);return t}function L(t,e,r,n,i){return t=32767*(t-r)/i,e=32767*(e-n)/i,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t|e<<1}function O(t){var e=t,r=t;do{e.x<r.x&&(r=e),e=e.next}while(e!==t);return r}function N(t,e,r,n,i,a,o,s){return(i-o)*(e-s)-(t-o)*(a-s)>=0&&(t-o)*(n-s)-(r-o)*(e-s)>=0&&(r-o)*(a-s)-(i-o)*(n-s)>=0}function U(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!z(t,e)&&j(t,e)&&j(e,t)&&Y(t,e)}function D(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function I(t,e){return t.x===e.x&&t.y===e.y}function V(t,e,r,n){return!!(I(t,e)&&I(r,n)||I(t,n)&&I(r,e))||D(t,e,r)>0!=D(t,e,n)>0&&D(r,n,t)>0!=D(r,n,e)>0}function z(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&V(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}function j(t,e){return D(t.prev,t,t.next)<0?D(t,e,t.next)>=0&&D(t,t.prev,e)>=0:D(t,e,t.prev)<0||D(t,t.next,e)<0}function Y(t,e){var r=t,n=!1,i=(t.x+e.x)/2,a=(t.y+e.y)/2;do{r.y>a!=r.next.y>a&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}function Z(t,e){var r=new H(t.i,t.x,t.y),n=new H(e.i,e.x,e.y),i=t.next,a=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}function q(t,e,r,n){var i=new H(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function W(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function H(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function G(t,e,r,n){for(var i=0,a=e,o=r-n;a<r;a+=n)i+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return i}function J(t,e,r,n,i,a){if(!(i-n<=r)){var o=Math.floor((n+i)/2);X(t,e,o,n,i,a%2),J(t,e,r,n,o-1,a+1),J(t,e,r,o+1,i,a+1)}}function X(t,e,r,n,i,a){for(;i>n;){if(i-n>600){var o=i-n+1,s=r-n+1,l=Math.log(o),h=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*h*(o-h)/o)*(s-o/2<0?-1:1);X(t,e,r,Math.max(n,Math.floor(r-s*h/o+u)),Math.min(i,Math.floor(r+(o-s)*h/o+u)),a)}var f=e[2*r+a],c=n,p=i;for(K(t,e,n,r),e[2*i+a]>f&&K(t,e,n,i);c<p;){for(K(t,e,c,p),c++,p--;e[2*c+a]<f;)c++;for(;e[2*p+a]>f;)p--}e[2*n+a]===f?K(t,e,n,p):K(t,e,++p,i),p<=r&&(n=p+1),r<=p&&(i=p-1)}}function K(t,e,r,n){$(t,r,n),$(e,2*r,2*n),$(e,2*r+1,2*n+1)}function $(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function Q(t,e,r,n){var i=t-r,a=e-n;return i*i+a*a}function tt(t,e,r,n,i){e=e||et,r=r||rt,i=i||Array,this.nodeSize=n||64,this.points=t,this.ids=new i(t.length),this.coords=new i(2*t.length);for(var a=0;a<t.length;a++)this.ids[a]=a,this.coords[2*a]=e(t[a]),this.coords[2*a+1]=r(t[a]);Vt(this.ids,this.coords,this.nodeSize,0,this.ids.length-1,0)}function et(t){return t[0]}function rt(t){return t[1]}function nt(t,e){return e={exports:{}},t(e,e.exports),e.exports}function it(){for(var t={},e=Gt.length,r=0;r<e;r++)t[Gt[r]]={distance:-1,parent:null};return t}function at(t){var e=it(),r=[t];for(e[t].distance=0;r.length;)for(var n=r.pop(),i=Object.keys(Ht[n]),a=i.length,o=0;o<a;o++){var s=i[o],l=e[s];-1===l.distance&&(l.distance=e[n].distance+1,l.parent=n,r.unshift(s))}return e}function ot(t,e){return function(r){return e(t(r))}}function st(t,e){for(var r=[e[t].parent,t],n=Ht[e[t].parent][t],i=e[t].parent;e[i].parent;)r.unshift(e[i].parent),n=ot(Ht[e[i].parent][i],n),i=e[i].parent;return n.conversion=r,n}function lt(t){var e=function(e){return void 0===e||null===e?e:(arguments.length>1&&(e=Array.prototype.slice.call(arguments)),t(e))};return"conversion"in t&&(e.conversion=t.conversion),e}function ht(t){var e=function(e){if(void 0===e||null===e)return e;arguments.length>1&&(e=Array.prototype.slice.call(arguments));var r=t(e);if("object"===(void 0===r?"undefined":_t(r)))for(var n=r.length,i=0;i<n;i++)r[i]=Math.round(r[i]);return r};return"conversion"in t&&(e.conversion=t.conversion),e}function ut(t){if(t){var e=/^#([a-fA-F0-9]{3})$/,r=/^#([a-fA-F0-9]{6})$/,n=/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,i=/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,a=/(\D+)/,o=[0,0,0],s=1,l=t.match(e);if(l){l=l[1];for(h=0;h<o.length;h++)o[h]=parseInt(l[h]+l[h],16)}else if(l=t.match(r)){l=l[1];for(h=0;h<o.length;h++)o[h]=parseInt(l.slice(2*h,2*h+2),16)}else if(l=t.match(n)){for(h=0;h<o.length;h++)o[h]=parseInt(l[h+1]);s=parseFloat(l[4])}else if(l=t.match(i)){for(h=0;h<o.length;h++)o[h]=Math.round(2.55*parseFloat(l[h+1]));s=parseFloat(l[4])}else if(l=t.match(a)){if("transparent"==l[1])return[0,0,0,0];if(!(o=Wt[l[1]]))return}for(var h=0;h<o.length;h++)o[h]=gt(o[h],0,255);return s=s||0==s?gt(s,0,1):1,o[3]=s,o}}function ft(t){if(t){var e=/^hsla?\(\s*([+-]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)/,r=t.match(e);if(r){var n=parseFloat(r[4]);return[gt(parseInt(r[1]),0,360),gt(parseFloat(r[2]),0,100),gt(parseFloat(r[3]),0,100),gt(isNaN(n)?1:n,0,1)]}}}function ct(t){if(t){var e=/^hwb\(\s*([+-]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)/,r=t.match(e);if(r){var n=parseFloat(r[4]);return[gt(parseInt(r[1]),0,360),gt(parseFloat(r[2]),0,100),gt(parseFloat(r[3]),0,100),gt(isNaN(n)?1:n,0,1)]}}}function pt(t,e){return void 0===e&&(e=void 0!==t[3]?t[3]:1),"rgba("+t[0]+", "+t[1]+", "+t[2]+", "+e+")"}function vt(t,e){return"rgba("+Math.round(t[0]/255*100)+"%, "+Math.round(t[1]/255*100)+"%, "+Math.round(t[2]/255*100)+"%, "+(e||t[3]||1)+")"}function yt(t,e){return void 0===e&&(e=void 0!==t[3]?t[3]:1),"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+e+")"}function gt(t,e,r){return Math.min(Math.max(e,t),r)}function dt(t){var e=t.toString(16).toUpperCase();return e.length<2?"0"+e:e}c(),function(){var t=new Float32Array(4);t[0]=0,t[1]=0,t[2]=0,t[3]=0}(),c(),p(1,0,0),p(0,1,0),function(){var t=new Float32Array(9);t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1}(),y(),y(),function(){var t=new Float32Array(2);t[0]=0,t[1]=0}();var _t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xt=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},mt=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):g(t,e))},bt=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},At=function(t){function e(r,n,i){xt(this,e);var a=bt(this,t.call(this,i));return a.gl=r,a.map=n,a}return mt(e,t),e}(e.Class),wt=Math.PI/180,St=function(t){function i(){return xt(this,i),bt(this,t.apply(this,arguments))}return mt(i,t),i.prototype.needToRedraw=function(){var e=this.getMap();return!(e.isZooming()&&!e.getPitch())&&t.prototype.needToRedraw.call(this)},i.prototype.createCanvas=function(){this.canvas||(t.prototype.createCanvas.call(this),this.layer.options.doubleBuffer&&(this.buffer=e.Canvas.createCanvas(this.canvas.width,this.canvas.height,this.getMap().CanvasClass),this.context=this.buffer.getContext("2d")))},i.prototype.createContext=function(){var t=this.gl=this._createGLContext(this.canvas,this.layer.options.glOptions);t.clearColor(0,0,0,0),t.enable(t.BLEND),_(t,this.layer.options.globalCompositeOperation||"source-over"),t.disable(t.DEPTH_TEST),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),this.onContextCreate()},i.prototype.onContextCreate=function(){},i.prototype.resizeCanvas=function(t){if(this.canvas){var r=void 0;r=t||this.getMap().getSize();var n=e.Browser.retina?2:1;this.canvas.height=n*r.height,this.canvas.width=n*r.width,this.gl.viewport(0,0,this.canvas.width,this.canvas.height)}},i.prototype.clearCanvas=function(){this.canvas&&(this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.context&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height))},i.prototype.mergeSprites=function(t,r){if(!t||0===t.length)return null;var n=0,i=0;t.forEach(function(t){if(r){var e=Math.max(t.canvas.width,t.canvas.height);n+=e+2,e>i&&(i=e)}else n+=t.canvas.width+2,t.canvas.height>i&&(i=t.canvas.height)}),n=Math.pow(2,Math.ceil(Math.log(n)/Math.LN2)),i=Math.pow(2,Math.ceil(Math.log(i)/Math.LN2));var a=this.getMap(),o=this.layer._spriteCanvas||e.Canvas.createCanvas(n,i,a.CanvasClass),s=o.getContext("2d"),l=[],h=[],u=[];o.width=n,o.height=i;var f=0;t.forEach(function(t){var e=0,a=0,o=void 0;if(r){var c=t.canvas.width,p=t.canvas.height;e=(o=Math.max(c,p))>c?(o-c)/2:0,a=o>p?(o-p)/2:0,l.push([f/n,o/n,o/i,o]),u.push([c,p])}else o=t.canvas.width,l.push([f/n,t.canvas.width/n,t.canvas.height/i]);s.drawImage(t.canvas,f+e,a),h.push(t.offset),f+=o+2});var c={canvas:o,texCoords:l,offsets:h};return r&&(c.sizes=u),c},i.prototype.createBuffer=function(){var t=this.gl.createBuffer();if(!t)throw new Error("Failed to create the buffer object");return this._buffers||(this._buffers=[]),this._buffers.push(t),t},i.prototype.enableVertexAttrib=function(t){var e=this.gl;if(Array.isArray(t[0])){for(var r=new Float32Array([0,0,0]).BYTES_PER_ELEMENT,n=0,i=0;i<t.length;i++)n+=t[i][1]||0;for(var a=0,o=0;o<t.length;o++){var s=e.getAttribLocation(e.program,t[o][0]);if(s<0)throw new Error("Failed to get the storage location of "+t[o][0]);e.vertexAttribPointer(s,t[o][1],e[t[o][2]||"FLOAT"],!1,r*n,r*a),a+=t[o][1]||0,e.enableVertexAttribArray(s)}}else{var l=e.getAttribLocation(e.program,t[0]);e.vertexAttribPointer(l,t[1],e[t[2]||"FLOAT"],!1,0,0),e.enableVertexAttribArray(l)}},i.prototype.onRemove=function(){var t=this.gl;this._buffers&&(this._buffers.forEach(function(e){t.deleteBuffer(e)}),delete this._buffers)},i.prototype.createProgram=function(t,e,r){var n=this.gl,i=this._compileShader(n,n.VERTEX_SHADER,t),a=this._compileShader(n,n.FRAGMENT_SHADER,e);if(!i||!a)return null;var o=n.createProgram();if(!o)return null;if(n.attachShader(o,i),n.attachShader(o,a),n.linkProgram(o),!n.getProgramParameter(o,n.LINK_STATUS)){var s=n.getProgramInfoLog(o);throw n.deleteProgram(o),n.deleteShader(a),n.deleteShader(i),new Error("Failed to link program: "+s)}return this._initUniforms(o,r),o},i.prototype.useProgram=function(t){var e=this.gl;return e.useProgram(t),e.program=t,this},i.prototype.loadTexture=function(t,e){var r=this.gl,n=r.createTexture();if(!n)throw new Error("Failed to create the texture object");return e||(e=0),r.activeTexture(r["TEXTURE"+e]),r.bindTexture(r.TEXTURE_2D,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t),n},i.prototype.enableSampler=function(t,e){var r=this.gl,n=this._getUniform(r.program,t);return e||(e=0),r.uniform1i(n,e),n},i.prototype._calcMatrices=function(){var t=this.getMap(),n=t.getSize(),i=t.getScale(),a=t._prjToPoint(t._getPrjCenter(),t.getMaxZoom()),f=t.getFov()*Math.PI/180,c=.5/Math.tan(f/2)*n.height*i,p=r();return u(p,f,n.width/n.height,1,c+1e9),e.Util.IS_NODE||s(p,p,[1,-1,1]),o(p,p,[0,0,-c]),l(p,p,t.getPitch()*Math.PI/180),h(p,p,-t.getBearing()*Math.PI/180),o(p,p,[-a.x,-a.y,0]),p},i.prototype.calcMatrices=function(){var t=this.getMap(),i=t.getSize(),o=t.getFov()*Math.PI/180,l=t.getScale(t.getMinZoom())/t.getScale(t.getMaxNativeZoom())*i.height/2/this._getFovRatio(),h=r();u(h,o,i.width/i.height,1,l);var f=r();return e.Util.IS_NODE||s(h,h,[1,-1,1]),n(f,h),a(h,f,this._getLookAtMat()),h},i.prototype._getLookAtMat=function(){var t=this.getMap(),e=d(t),n=t.getSize(),i=t.getScale()/t.getScale(e),a=this.cameraCenter=t.coordinateToPoint(t.getCenter(),e),o=t.getPitch()*wt,s=-t.getBearing()*wt,l=this._getFovRatio(),h=i*n.height/2/l,u=h*Math.cos(o),c=Math.sin(o)*h,p=a.x+c*Math.sin(s),v=a.y+c*Math.cos(s),y=[Math.sin(s),Math.cos(s),0],g=r();return f(g,[p,v,u],[a.x,a.y,0],y),g},i.prototype._getFovRatio=function(){var t=this.getMap().getFov();return Math.tan(t/2*Math.PI/180)},i.prototype.hitDetect=function(t){var e=this.gl;if(!e)return!1;var r=new Uint8Array(4),n=this.canvas.height;return e.readPixels(t.x,n-t.y,1,1,e.RGBA,e.UNSIGNED_BYTE,r),r[3]>0},i.prototype.getCanvasImage=function(){var e=t.prototype.getCanvasImage.call(this);if(e&&e.image&&this.buffer){var r=e.image;this.buffer.width===r.width&&this.buffer.height===r.height&&this._preserveBuffer||(this.buffer.width=r.width,this.buffer.height=r.height),this._preserveBuffer||this.context.drawImage(r,0,0),e.image=this.buffer}return e},i.prototype.onZoomStart=function(){t.prototype.onZoomStart.apply(this,arguments)},i.prototype.onZoomEnd=function(){t.prototype.onZoomEnd.apply(this,arguments)},i.prototype._createGLContext=function(t,r){for(var n=e.Util.extend({alpha:!0,antialias:!0,preserveDrawingBuffer:!0},r),i=["webgl","experimental-webgl","webkit-3d","moz-webgl"],a=null,o=0;o<i.length;++o){try{a=t.getContext(i[o],n)}catch(t){}if(a)break}return a},i.prototype._compileShader=function(t,e,r){var n=t.createShader(e);if(null==n)throw new Error("unable to create shader");if(t.shaderSource(n,r),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS)){var i=t.getShaderInfoLog(n);throw t.deleteShader(n),new Error("Failed to compile shader: "+i)}return n},i.prototype._initUniforms=function(t,r){for(var n=0;n<r.length;n++){var i=r[n],a=r[n],o=i.indexOf("[");o>=0&&(i=i.substring(0,o),e.Util.IS_NODE||(a=a.substring(0,o))),t[i]=this._getUniform(t,a)}},i.prototype._getUniform=function(t,e){var r=this.gl.getUniformLocation(t,e);if(!r)throw new Error("Failed to get the storage location of "+e);return r},i}(e.renderer.CanvasRenderer),Et=function(){function t(e,r){xt(this,t),this.resources=e,this.options=r||{},this.atlas={}}return t.prototype.getAtlas=function(t){var e=JSON.stringify(t);if(!this.atlas[e]){var r=this.addAtlas(t);r&&(this.atlas[e]=r)}return this.atlas[e]},t.prototype.addAtlas=function(t){if(!t.lineDasharray&&!t.linePatternFile)return null;var r=this._getSize(t,this.resources),n=this._createCanvas(r);if(!n)throw new Error("can not initialize canvas container.");var i=n.getContext("2d");return e.Canvas.prepareCanvas(i,t,this.resources),i.moveTo(0,r[1]/2),i.lineTo(r[0],r[1]/2),i.stroke(),{canvas:n,offset:new e.Point(0,0)}},t.prototype._getSize=function(t,e){var r=0,n=0,i=t.lineDasharray;if(i){for(var a=0;a<i.length;a++)r+=i[a];i.length%2==1&&(r*=2),n=null==t.lineWidth?2:t.lineWidth}if(t.linePatternFile){var o=e.getImage(t.linePatternFile);o.width>r&&(r=o.width),o.height>n&&(n=o.height)}return[r,n]},t.prototype._createCanvas=function(t){if(this.options.canvasClass)return new this.options.canvasClass(t[0],t[1]);if("undefined"!=typeof document){var e=document.createElement("canvas");return e.width=t[0],e.height=t[1],e}return null},t}(),Mt=x;x.prototype={clone:function(){return new x(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=e*this.x-r*this.y,i=r*this.x+e*this.y;return this.x=n,this.y=i,this},_rotateAround:function(t,e){var r=Math.cos(t),n=Math.sin(t),i=e.x+r*(this.x-e.x)-n*(this.y-e.y),a=e.y+n*(this.x-e.x)+r*(this.y-e.y);return this.x=i,this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},x.convert=function(t){return t instanceof x?t:Array.isArray(t)?new x(t[0],t[1]):t};var Rt={project:!0},Ct=function(t){function r(e,n,i){xt(this,r);var a=bt(this,t.call(this,e,n,i));return a.vertexArray=[],a.normalArray=[],a.elementArray=[],a.styleArray=[],a.distance=0,a}return mt(r,t),r.prototype.getArrays=function(){return{vertexArray:this.vertexArray,normalArray:this.normalArray,elementArray:this.elementArray,styleArray:this.styleArray}},r.prototype.addLine=function(t,r){if(!t)return this;if(r.symbol.lineWidth<=0||r.symbol.lineOpacity<=0)return this;var n=this.vertexArray.length,i=this._getVertice(t);if(i[0]&&Array.isArray(i[0][0])){for(var a=0,o=i.length;a<o;a++)this.addLine(i[a],r);return this}this._prepareToAdd();for(var s=d(this.map),l=void 0,h=void 0,u=0,f=i.length;u<f;u++){var c=i[u];this.options.project&&(c=this.map.coordinateToPoint(new e.Coordinate(c),s).toArray()),l=Mt.convert(c),u<f-1?(c=i[u+1],this.options.project&&(c=this.map.coordinateToPoint(new e.Coordinate(c),s).toArray()),h=Mt.convert(c)):h=null,this.addCurrentVertex(l,h)}var p=this.vertexArray.length-n;return this._addTexCoords(p,r),this},r.prototype.addCurrentVertex=function(t,e){if(!this.preVertex)return this.e1=this.e2=this.e3=-1,this._waitForLeftCap=!0,void(this.preVertex=t);var r=t.sub(this.preVertex)._unit()._perp()._mult(-1),n=void 0;e&&(n=e.sub(t)._unit()._perp()._mult(-1));var i=this._getStartNormal(r,this.preNormal);if(this._addLineEndVertexs(this.preVertex,i,this.distance),this.distance+=t.dist(this.preVertex),!e){var a=this._getEndNormal(r,n);this._addLineEndVertexs(t,a,this.distance)}this.preNormal=r,this.preVertex=t},r.prototype._prepareToAdd=function(){this.distance=0,delete this.preVertex,delete this.preNormal},r.prototype._addLineEndVertexs=function(t,e,r){var n=e.normal[0];this.e3=this._addVertex(t,n,r),this.e1>=0&&this.e2>=0&&this.elementArray.push(this.e1,this.e2,this.e3),this.e1=this.e2,this.e2=this.e3,n=e.normal[1],this.e3=this._addVertex(t,n,r),this.e1>=0&&this.e2>=0&&this.elementArray.push(this.e1,this.e2,this.e3),this.e1=this.e2,this.e2=this.e3},r.prototype._addVertex=function(t,r,n){this.vertexArray.push(t.x,t.y);var i=[this._precise(r.x),this._precise(r.y),n],a=this.normalArray.length/i.length;return e.Util.pushIn(this.normalArray,i),a},r.prototype._getVertice=function(t){return t.geometry?t=t.geometry.coordinates:t.coordinates&&(t=t.coordinates),t},r.prototype._addTexCoords=function(t,e){var r=(e.symbol.lineWidth||2)/2*100+10*(e.symbol.lineOpacity||1);r=1e4*r+e.index;for(var n=0;n<t;n++)this.styleArray.push(r)},r.prototype._getStartNormal=function(t,e){return this._getJoinNormal(t,e,t)},r.prototype._getEndNormal=function(t,e){return this._getJoinNormal(t,t,e)},r.prototype._getJoinNormal=function(t,e,r){if(!e||!r)return{normal:[t,t.mult(-1)]};var n=e.add(r)._unit(),i=1/(n.x*r.x+n.y*r.y);return n._mult(i),{normal:[n,n.mult(-1)]}},r.prototype._precise=function(t){return Math.round(1e7*t)/1e7},r}(At);Ct.mergeOptions(Rt);var Ft=m;m.deviation=function(t,e,r,n){var i=e&&e.length,a=i?e[0]*r:t.length,o=Math.abs(G(t,0,a,r));if(i)for(var s=0,l=e.length;s<l;s++){var h=e[s]*r,u=s<l-1?e[s+1]*r:t.length;o-=Math.abs(G(t,h,u,r))}var f=0;for(s=0;s<n.length;s+=3){var c=n[s]*r,p=n[s+1]*r,v=n[s+2]*r;f+=Math.abs((t[c]-t[v])*(t[p+1]-t[c+1])-(t[c]-t[p])*(t[v+1]-t[c+1]))}return 0===o&&0===f?0:Math.abs((f-o)/o)},m.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var a=0;a<t[i].length;a++)for(var o=0;o<e;o++)r.vertices.push(t[i][a][o]);i>0&&(n+=t[i-1].length,r.holes.push(n))}return r};var Bt={project:!0},Tt=function(t){function r(e,n,i){xt(this,r);var a=bt(this,t.call(this,e,n,i));return a.vertexArray=[],a.elementArray=[],a.styleArray=[],a}return mt(r,t),r.prototype.getArrays=function(){return{vertexArray:this.vertexArray,elementArray:this.elementArray,styleArray:this.styleArray}},r.prototype.addPolygon=function(t,r){var n=this;if(!t)return this;if(r.symbol.polygonOpacity<=0)return this;var i=this._getVertice(t);if(i[0]&&Array.isArray(i[0][0])&&Array.isArray(i[0][0][0])){for(var a=0,o=i.length;a<o;a++)this.addPolygon(i[a],r);return this}i.forEach(function(t){t.length&&(n._equalCoord(t[0],t[t.length-1])||t.push(t[0],t[1]))});var s=d(this.map),l=Ft.flatten(i);if(this.options.project){for(var h=[],u=void 0,f=0,c=l.vertices.length;f<c;f+=2)u=this.map.coordinateToPoint(new e.Coordinate(l.vertices[f],l.vertices[f+1]),s),h.push(u.x,u.y);l.vertices=h}var p=Ft(l.vertices,l.holes,2);if(p.length<=2)return this;var v=Ft.deviation(l.vertices,l.holes,2,p);if(Math.round(1e3*v)/1e3!=0)return console&&console.warn("Failed triangluation."),this;var y=this.vertexArray.length/2;return y>0&&(p=p.map(function(t){return t+y})),e.Util.pushIn(this.vertexArray,l.vertices),e.Util.pushIn(this.elementArray,p),this._addTexCoords(l.vertices.length/2,r),this},r.prototype._getVertice=function(t){return t.geometry?t=t.geometry.coordinates:t.coordinates&&(t=t.coordinates),t},r.prototype._addTexCoords=function(t,e){for(var r=100*e.index+10*(e.symbol.polygonOpacity||1),n=0;n<t;n++)this.styleArray.push(r)},r.prototype._equalCoord=function(t,e){return t[0]===e[0]&&t[1]===e[1]},r}(At);Tt.mergeOptions(Bt);var kt=e.Browser.ie||e.Browser.edge?504:e.Util.IS_NODE?1014:240,Pt={line:{fragmentSource:"#ifdef GL_ES\r\nprecision mediump float;\r\n#else\r\n#define lowp\r\n#define mediump\r\n#define highp\r\n#endif\r\n\r\nuniform float u_blur;\r\nuniform vec2 u_tex_size;\r\n\r\n// varying lowp vec4 v_color;\r\n// varying vec2 v_linenormal;\r\nvarying vec4 v_texcoord;\r\nvarying float v_opacity;\r\nvarying float v_linewidth;\r\nvarying float v_scale;\r\nvarying float v_texture_normal;\r\nvarying float v_linesofar;\r\n// varying float v_ruler;\r\n\r\nuniform sampler2D u_image;\r\n\r\nvoid main() {\r\n    vec4 color;\r\n    if (v_texcoord.q == -1.0) {\r\n        // is a texture fragment\r\n        float linesofar = v_linesofar / v_scale;\r\n        float texWidth = u_tex_size.x * v_texcoord.t;\r\n        float x = v_texcoord.s + mod(linesofar, texWidth) / texWidth * v_texcoord.t;\r\n        float y = (v_texture_normal + 1.0) / 2.0 * v_texcoord.p;\r\n\r\n        color = texture2D(u_image, vec2(x, y));\r\n    } else {\r\n        // a color fragment\r\n        color = v_texcoord;\r\n    }\r\n    float alpha = 1.0;\r\n    gl_FragColor = color * (alpha * v_opacity);\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",vertexSource:"#ifdef GL_ES\r\nprecision highp float;\r\n#else\r\n#define lowp\r\n#define mediump\r\n#define highp\r\n#endif\r\n\r\nattribute vec4 a_pos;\r\nattribute mediump vec2 a_normal;\r\n// attribute mediump vec2 a_linenormal;\r\nattribute float a_linesofar;\r\n// (line_width * 100 + opacity * 10) * 10000 + tex_idx\r\nattribute float a_style;\r\n// attribute float a_seglen;\r\n\r\nuniform mat4 u_matrix;\r\nuniform float u_scale;\r\nuniform float u_styles[maxUniformLength];\r\n\r\nvarying vec2 v_linenormal;\r\nvarying float v_linewidth;\r\nvarying float v_opacity;\r\nvarying vec4 v_texcoord;\r\nvarying float v_scale;\r\nvarying float v_texture_normal;\r\n\r\nvarying float v_linesofar;\r\n// varying float v_ruler;\r\n\r\nvoid main() {\r\n    int tex_idx = int(mod(a_style, 10000.0));\r\n    float s = floor(a_style / 10000.0);\r\n    v_opacity = mod(s, 10.0) / 10.0;\r\n    if (v_opacity == 0.0) {\r\n        v_opacity = 1.0;\r\n    }\r\n    v_linewidth = s / 100.0;\r\n    v_texcoord = vec4(u_styles[tex_idx], u_styles[tex_idx + 1], u_styles[tex_idx + 2], u_styles[tex_idx + 3]);\r\n\r\n    v_scale = u_scale;\r\n\r\n    // v_linenormal = a_linenormal;\r\n\r\n    vec4 pos = a_pos;\r\n    pos.x += a_normal.x * v_linewidth * u_scale;\r\n    pos.y += a_normal.y * v_linewidth * u_scale;\r\n\r\n    // add linesofar with corner length caused by line-join\r\n    v_linesofar = a_linesofar;\r\n\r\n\r\n    gl_Position = u_matrix * pos;\r\n    if (a_normal.y == 0.0) {\r\n        // with an upside down straight line, a_normal.y is always 0, use a_normal.x instead\r\n        v_texture_normal = -sign(a_normal.x);\r\n    } else {\r\n        //\r\n        v_texture_normal = sign(a_normal.y);\r\n    }\r\n}\r\n"},point:{fragmentSource:"precision mediump float;\r\nuniform sampler2D u_sampler;\r\nvarying vec3 v_texCoord;\r\nvoid main() {\r\n    gl_FragColor = texture2D(u_sampler, vec2(v_texCoord[0] + gl_PointCoord[0] * v_texCoord[1], 1.0 + gl_PointCoord[1] * v_texCoord[2]));\r\n}\r\n",vertexSource:"// marker's 2d point at max zoom\r\nattribute vec4 a_pos;\r\n\r\n// texture idx in u_sprite\r\nattribute float a_sprite_idx;\r\n\r\nuniform mat4 u_matrix;\r\n\r\n// scale of current zoom\r\nuniform float u_scale;\r\n\r\n// sprites, an array of sprites\r\n// a sprite has 6 integers:\r\n// 0 : northwest's x, 1 : width, 2: height, 3: sprite size, 4: offset x, 5: offset y\r\n// array's length is not dynamic, support maximum count / 6 sprites\r\nuniform float u_sprite[maxUniformLength];\r\n\r\nvarying vec3 v_texCoord;\r\n\r\nvoid main() {\r\n  int idx = int(a_sprite_idx) * 6;\r\n  float size = u_sprite[idx + 3];\r\n  vec2 textOffset = vec2(u_sprite[idx + 4], u_sprite[idx + 5]);\r\n\r\n  vec4 pos = vec4(a_pos.x + textOffset.x * u_scale, a_pos.y + textOffset.y * u_scale, a_pos.z, a_pos.w);\r\n\r\n  gl_Position = u_matrix * pos;\r\n\r\n  gl_PointSize = size;\r\n\r\n  // texture coord\r\n  v_texCoord = vec3(u_sprite[idx], u_sprite[idx + 1], u_sprite[idx + 2]);\r\n}\r\n"},polygon:{fragmentSource:"precision mediump float;\r\n\r\nvarying vec4 v_texcoord;\r\nvarying float v_opacity;\r\nvoid main() {\r\n    gl_FragColor = v_texcoord * v_opacity;\r\n}\r\n",vertexSource:"attribute vec4 a_pos;\r\n//tex_idx * 100 + opacity * 10\r\nattribute float a_fill_style;\r\n\r\nuniform mat4 u_matrix;\r\nuniform float u_fill_styles[maxUniformLength];\r\n\r\nvarying float v_opacity;\r\nvarying vec4 v_texcoord;\r\n\r\nvoid main() {\r\n  int tex_idx = int(floor(a_fill_style / 100.0));\r\n  v_opacity = mod(a_fill_style, 100.0) / 10.0;\r\n  v_texcoord = vec4(u_fill_styles[tex_idx], u_fill_styles[tex_idx + 1], u_fill_styles[tex_idx + 2], u_fill_styles[tex_idx + 3]);\r\n\r\n  gl_Position = u_matrix * a_pos;\r\n}\r\n"},extrude:{fragmentSource:"precision mediump float;\r\n\r\nvarying vec4 v_texcoord;\r\nvarying float v_opacity;\r\n// varying vec4 v_lighting;\r\n\r\nvoid main() {\r\n    gl_FragColor = v_texcoord * v_opacity;\r\n}\r\n",vertexSource:"attribute vec4 a_pos;\r\nattribute vec4 a_normal;\r\n//tex_idx * 100 + opacity * 10\r\nattribute float a_fill_style;\r\n\r\nuniform vec3 u_lightcolor;\r\nuniform lowp vec3 u_lightpos;\r\nuniform lowp vec3 u_ambientlight;\r\nuniform lowp float u_lightintensity;\r\n// uniform vec3 u_ambientlight;\r\n\r\nuniform mat4 u_matrix;\r\nuniform float u_fill_styles[maxUniformLength];\r\n\r\nvarying float v_opacity;\r\nvarying vec4 v_texcoord;\r\n\r\nvarying vec4 v_lighting;\r\n\r\nvoid main() {\r\n  int tex_idx = int(a_fill_style / 100.0) * 4;\r\n  v_opacity = mod(a_fill_style, 100.0) / 10.0;\r\n\r\n  vec4 color = vec4(u_fill_styles[tex_idx], u_fill_styles[tex_idx + 1], u_fill_styles[tex_idx + 2], u_fill_styles[tex_idx + 3]);\r\n\r\n  gl_Position = u_matrix * a_pos;\r\n\r\n  vec3 normal = normalize(a_normal.xyz);\r\n  // // vec3 lightpos = normalize(u_lightpos);\r\n  // float nDotL = max(dot(u_lightpos, normal), 0.0);\r\n  // vec3 diffuse = u_lightcolor * color.rgb * nDotL;\r\n\r\n  // vec3 ambient = u_ambientlight * color.rgb;\r\n\r\n  // v_texcoord = vec4(diffuse + ambient, color.a);\r\n\r\n  // Relative luminance (how dark/bright is the surface color?)\r\n  float colorvalue = color.r * 0.2126 + color.g * 0.7152 + color.b * 0.0722;\r\n  // Add slight ambient lighting so no extrusions are totally black\r\n    vec4 ambientlight = vec4(u_ambientlight, 1.0);\r\n    color += ambientlight;\r\n\r\n    // Calculate cos(theta), where theta is the angle between surface normal and diffuse light ray\r\n    float directional = clamp(dot(normal, u_lightpos), 0.0, 1.0);\r\n\r\n    // Adjust directional so that\r\n    // the range of values for highlight/shading is narrower\r\n    // with lower light intensity\r\n    // and with lighter/brighter surface colors\r\n    directional = mix((1.0 - u_lightintensity), max((1.0 - colorvalue + u_lightintensity), 1.0), directional);\r\n\r\n    // Add gradient along z axis of side surfaces\r\n    // if (normal.y != 0.0) {\r\n    //     directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\r\n    // }\r\n\r\n    // Assign final color based on surface + ambient light color, diffuse light directional, and light color\r\n    // with lower bounds adjusted to hue of light\r\n    // so that shading is tinted with the complementary (opposite) color to the light color\r\n    v_texcoord.r += clamp(color.r * directional * u_lightcolor.r, mix(0.0, 0.3, 1.0 - u_lightcolor.r), 1.0);\r\n    v_texcoord.g += clamp(color.g * directional * u_lightcolor.g, mix(0.0, 0.3, 1.0 - u_lightcolor.g), 1.0);\r\n    v_texcoord.b += clamp(color.b * directional * u_lightcolor.b, mix(0.0, 0.3, 1.0 - u_lightcolor.b), 1.0);\r\n    v_texcoord.a = color.a;\r\n  // vec3 normal = normalize(a_normal.xyz);\r\n  // vec3 lightpos = normalize(u_lightpos.xyz);\r\n  // // codes from mapbox-gl-js\r\n  // v_lighting = vec4(0.0, 0.0, 0.0, 1.0);\r\n  // float directional = clamp(dot(normal, lightpos), 0.0, 1.0);\r\n  // directional = mix((1.0 - u_lightintensity), max((0.5 + u_lightintensity), 1.0), directional);\r\n\r\n  // // if (a_normal.y != 0.0) {\r\n  // //   directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\r\n  // // }\r\n\r\n  // v_lighting.rgb += clamp(directional * u_lightcolor, mix(vec3(0.0), vec3(0.3), 1.0 - u_lightcolor), vec3(1.0));\r\n}\r\n"}},Lt=/maxUniformLength/g;for(var Ot in Pt){var Nt=Pt[Ot];Nt.fragmentSource=Nt.fragmentSource.replace(Lt,kt),Nt.vertexSource=Nt.vertexSource.replace(Lt,kt)}var Ut=Object.freeze({WebglRenderer:St,Shader:Pt,Painter:At,LineAtlas:Et,LinePainter:Ct,PolygonPainter:Tt}),Dt={renderer:"webgl",doublBuffer:!0,renderOnMoving:!1,renderOnZooming:!1},It=function(t){function r(n,i,a){xt(this,r);var o=e.Util.extend({},a),s=void 0;o.style&&(s=o.style,delete o.style);var l=void 0;o.spriteCanvas&&(l=o.spriteCanvas,delete o.spriteCanvas);var h=bt(this,t.call(this,n,o));return h.data=i,s&&h.setStyle(s),l&&(h._spriteCanvas=l),h}return mt(r,t),r.fromJSON=function(t){if(!t||t.type!==this.getJSONType())return null;var e=new(0,this.prototype.constructor)(t.id,t.data,t.options);return t.style&&e.setStyle(t.style),e},r.prototype.toJSON=function(){var t={type:this.getJSONType(),data:this.data,id:this.getId()},e=this.config(),r=this.getStyle();return e&&(t.options=e),r&&(t.style=r),t},r.prototype.setStyle=function(t){return Array.isArray(t)||(t=[t]),this._style=t,this._cookedStyles=e.MapboxUtil.compileStyle(t),this.fire("setstyle",{style:t}),this},r.prototype.getStyle=function(){return this._style},r}(e.Layer);It.mergeOptions(Dt);var Vt=J,zt=function(t,e,r,n,i,a,o){for(var s,l,h=[0,t.length-1,0],u=[];h.length;){var f=h.pop(),c=h.pop(),p=h.pop();if(c-p<=o)for(var v=p;v<=c;v++)s=e[2*v],l=e[2*v+1],s>=r&&s<=i&&l>=n&&l<=a&&u.push(t[v]);else{var y=Math.floor((p+c)/2);s=e[2*y],l=e[2*y+1],s>=r&&s<=i&&l>=n&&l<=a&&u.push(t[y]);var g=(f+1)%2;(0===f?r<=s:n<=l)&&(h.push(p),h.push(y-1),h.push(g)),(0===f?i>=s:a>=l)&&(h.push(y+1),h.push(c),h.push(g))}}return u},jt=function(t,e,r,n,i,a){for(var o=[0,t.length-1,0],s=[],l=i*i;o.length;){var h=o.pop(),u=o.pop(),f=o.pop();if(u-f<=a)for(var c=f;c<=u;c++)Q(e[2*c],e[2*c+1],r,n)<=l&&s.push(t[c]);else{var p=Math.floor((f+u)/2),v=e[2*p],y=e[2*p+1];Q(v,y,r,n)<=l&&s.push(t[p]);var g=(h+1)%2;(0===h?r-i<=v:n-i<=y)&&(o.push(f),o.push(p-1),o.push(g)),(0===h?r+i>=v:n+i>=y)&&(o.push(p+1),o.push(u),o.push(g))}}return s},Yt=function(t,e,r,n,i){return new tt(t,e,r,n,i)};tt.prototype={range:function(t,e,r,n){return zt(this.ids,this.coords,t,e,r,n,this.nodeSize)},within:function(t,e,r){return jt(this.ids,this.coords,t,e,r,this.nodeSize)}};var Zt=function(t){function e(){return xt(this,e),bt(this,t.apply(this,arguments))}return mt(e,t),e.prototype.identify=function(t,e){var r=this._getRenderer();return r?r.identify(t,e):null},e}(It);Zt.registerJSONType("BigPointLayer"),Zt.registerRenderer("webgl",function(t){function r(e){xt(this,r);var n=bt(this,t.call(this,e));return n._needCheckStyle=!0,n._needCheckSprites=!0,n._registerEvents(),n}return mt(r,t),r.prototype.checkResources=function(){if(!this._needCheckStyle)return[];var t=[];return this.layer.getStyle()&&this.layer.getStyle().forEach(function(r){var n=e.Util.getExternalResources(r.symbol,!0);Array.isArray(n)&&n.length>0&&(Array.isArray(n[0])?e.Util.pushIn(t,n):t.push(n))}),this._needCheckStyle=!1,this._needCheckSprites=!0,this._textureLoaded=!1,t},r.prototype.onContextCreate=function(){var t=this.gl,e=["u_matrix","u_scale","u_sprite[0]"],r=this.createProgram(Pt.point.vertexSource,Pt.point.fragmentSource,e);this.useProgram(r);var n=this.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),this.enableVertexAttrib([["a_pos",2],["a_sprite_idx",1]])},r.prototype.draw=function(){if(this.prepareCanvas(),this._checkSprites(),!this._vertexCount){var t=this.getMap(),r=d(t),n=this.layer.data,i=[],a=[];this._vertexCount=0;for(var o=this.gl,s=[0,0],l=0,h=n.length;l<h;l++)if(n[l]){var u=void 0;if(Array.isArray(n[l]))u=n[l];else if(n[l].type){var f=this._getVertice(n[l]);u=[f[0],f[1],n[l].properties]}var c=this._getTexCoord({properties:u[2]});if(c){this._vertexCount++;var p=t.coordinateToPoint(new e.Coordinate(u),r);i.push(p.x,p.y,c.idx),a.push([p.x,p.y,c.size,c.offset,u]),c.size[0]>s[0]&&(s[0]=c.size[0]),c.size[1]>s[1]&&(s[1]=c.size[1])}}o.bufferData(o.ARRAY_BUFFER,new Float32Array(i),o.STATIC_DRAW),this._maxIconSize=s,this._indexData(a)}this._drawMarkers(),this.completeRender()},r.prototype.drawOnInteracting=function(){this._drawMarkers(),this.completeRender()},r.prototype.onRemove=function(){this._removeEvents(),delete this._sprites,delete this._uSprite,t.prototype.onRemove.apply(this,arguments)},r.prototype.identify=function(t,e){if(!this._kdIndex)return null;var r=this.getMap(),n=d(r),i=r.coordinateToPoint(t,n),a=r.getScale()/r.getScale(n),o=a*this._maxIconSize[0],s=a*this._maxIconSize[1];o<1&&(o=1),s<1&&(s=1);var l=this._kdIndex.range(i.x-o,i.y-s,i.x+o,i.y+s),h=void 0,u=void 0;e&&(e.filter&&(h=e.filter),e.count&&(u=e.count));for(var f=[],c=0,p=l.length;c<p;c++){var v=this._indexPoints[l[c]],y=v[0],g=v[1],_=v[2],x=v[3],m=[a*(-_[0]/2+x.x),a*(-_[1]/2+x.y),a*(_[0]/2+x.x),a*(_[1]/2+x.y)];if(i.x>=y+m[0]&&i.x<=y+m[2]&&i.y>=g+m[1]&&i.y<=g+m[3]&&(h&&!h(v[4])||f.push(v[4]),u&&f.length>=u))break}return f},r.prototype._indexData=function(t){this._indexPoints=t,this._kdIndex=Yt(t,null,null,64,Int32Array)},r.prototype._getTexCoord=function(t){if(!this.layer._cookedStyles)return null;for(var e=0,r=this.layer._cookedStyles.length;e<r;e++)if(!0===this.layer._cookedStyles[e].filter(t))return{idx:e,texCoord:this._sprites.texCoords[e],offset:this._sprites.offsets[e],size:this._sprites.sizes[e]};return null},r.prototype._checkSprites=function(){if(this._needCheckSprites){var t=this.resources,r=[];if(this.layer.getStyle()){var n=this.getMap();this.layer.getStyle().forEach(function(i){var a=new e.Marker([0,0],{symbol:i.symbol})._getSprite(t,n.CanvasClass);a&&r.push(a)})}if(this._sprites=this.mergeSprites(r,!0),this._sprites&&(this._needCheckSprites=!1,!this._textureLoaded)){var i=this._sprites.canvas.getContext("2d"),a=this._sprites.canvas.width,o=this._sprites.canvas.height,s=i.getImageData(0,0,a,o);this.loadTexture(s),this.enableSampler("u_sampler"),this._textureLoaded=!0;for(var l=this._uSprite=[],h=0,u=this.layer._cookedStyles.length;h<u;h++)l.push.apply(l,this._sprites.texCoords[h]),l.push(this._sprites.offsets[h].x,this._sprites.offsets[h].y);this.gl.uniform1fv(this.gl.program.u_sprite,this._uSprite)}}},r.prototype._getVertice=function(t){return t.geometry?t=t.geometry.coordinates:t.coordinates&&(t=t.coordinates),t},r.prototype._drawMarkers=function(){var t=this.gl,e=this.calcMatrices();t.uniformMatrix4fv(t.program.u_matrix,!1,e);var r=this.getMap();t.uniform1f(t.program.u_scale,r.getScale()/r.getScale(d(r))),t.drawArrays(t.POINTS,0,this._vertexCount)},r.prototype._registerEvents=function(){this.layer.on("setstyle",this._onStyleChanged,this)},r.prototype._removeEvents=function(){this.layer.off("setstyle",this._onStyleChanged,this)},r.prototype._onStyleChanged=function(){this._needCheckStyle=!0},r}(St));var qt=nt(function(t){var e=function(){function t(e,n,i,a){function o(e,i){if(null===e)return null;if(0==i)return e;var u,f;if("object"!=(void 0===e?"undefined":_t(e)))return e;if(t.__isArray(e))u=[];else if(t.__isRegExp(e))u=new RegExp(e.source,r(e)),e.lastIndex&&(u.lastIndex=e.lastIndex);else if(t.__isDate(e))u=new Date(e.getTime());else{if(h&&Buffer.isBuffer(e))return u=new Buffer(e.length),e.copy(u),u;void 0===a?(f=Object.getPrototypeOf(e),u=Object.create(f)):(u=Object.create(a),f=a)}if(n){var c=s.indexOf(e);if(-1!=c)return l[c];s.push(e),l.push(u)}for(var p in e){var v;f&&(v=Object.getOwnPropertyDescriptor(f,p)),v&&null==v.set||(u[p]=o(e[p],i-1))}return u}"object"===(void 0===n?"undefined":_t(n))&&(i=n.depth,a=n.prototype,n.filter,n=n.circular);var s=[],l=[],h="undefined"!=typeof Buffer;return void 0===n&&(n=!0),void 0===i&&(i=1/0),o(e,i)}function e(t){return Object.prototype.toString.call(t)}function r(t){var e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),e}return t.clonePrototype=function(t){if(null===t)return null;var e=function(){};return e.prototype=t,new e},t.__objToStr=e,t.__isDate=function(t){return"object"===(void 0===t?"undefined":_t(t))&&"[object Date]"===e(t)},t.__isArray=function(t){return"object"===(void 0===t?"undefined":_t(t))&&"[object Array]"===e(t)},t.__isRegExp=function(t){return"object"===(void 0===t?"undefined":_t(t))&&"[object RegExp]"===e(t)},t.__getRegExpFlags=r,t}();t.exports&&(t.exports=e)}),Wt={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},Ht=nt(function(t){function e(t,e){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2)}var r={};for(var n in Wt)Wt.hasOwnProperty(n)&&(r[Wt[n]]=n);var i=t.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var a in i)if(i.hasOwnProperty(a)){if(!("channels"in i[a]))throw new Error("missing channels property: "+a);if(!("labels"in i[a]))throw new Error("missing channel labels property: "+a);if(i[a].labels.length!==i[a].channels)throw new Error("channel and label counts mismatch: "+a);var o=i[a].channels,s=i[a].labels;delete i[a].channels,delete i[a].labels,Object.defineProperty(i[a],"channels",{value:o}),Object.defineProperty(i[a],"labels",{value:s})}i.rgb.hsl=function(t){var e,r,n,i=t[0]/255,a=t[1]/255,o=t[2]/255,s=Math.min(i,a,o),l=Math.max(i,a,o),h=l-s;return l===s?e=0:i===l?e=(a-o)/h:a===l?e=2+(o-i)/h:o===l&&(e=4+(i-a)/h),(e=Math.min(60*e,360))<0&&(e+=360),n=(s+l)/2,r=l===s?0:n<=.5?h/(l+s):h/(2-l-s),[e,100*r,100*n]},i.rgb.hsv=function(t){var e,r,n,i=t[0],a=t[1],o=t[2],s=Math.min(i,a,o),l=Math.max(i,a,o),h=l-s;return r=0===l?0:h/l*1e3/10,l===s?e=0:i===l?e=(a-o)/h:a===l?e=2+(o-i)/h:o===l&&(e=4+(i-a)/h),(e=Math.min(60*e,360))<0&&(e+=360),n=l/255*1e3/10,[e,r,n]},i.rgb.hwb=function(t){var e=t[0],r=t[1],n=t[2],a=i.rgb.hsl(t)[0],o=1/255*Math.min(e,Math.min(r,n));return n=1-1/255*Math.max(e,Math.max(r,n)),[a,100*o,100*n]},i.rgb.cmyk=function(t){var e,r,n,i,a=t[0]/255,o=t[1]/255,s=t[2]/255;return i=Math.min(1-a,1-o,1-s),e=(1-a-i)/(1-i)||0,r=(1-o-i)/(1-i)||0,n=(1-s-i)/(1-i)||0,[100*e,100*r,100*n,100*i]},i.rgb.keyword=function(t){var n=r[t];if(n)return n;var i,a=1/0;for(var o in Wt)if(Wt.hasOwnProperty(o)){var s=e(t,Wt[o]);s<a&&(a=s,i=o)}return i},i.keyword.rgb=function(t){return Wt[t]},i.rgb.xyz=function(t){var e=t[0]/255,r=t[1]/255,n=t[2]/255;return[100*(.4124*(e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92)+.3576*(r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92)+.1805*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92)),100*(.2126*e+.7152*r+.0722*n),100*(.0193*e+.1192*r+.9505*n)]},i.rgb.lab=function(t){var e,r,n,a=i.rgb.xyz(t),o=a[0],s=a[1],l=a[2];return o/=95.047,s/=100,l/=108.883,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,s=s>.008856?Math.pow(s,1/3):7.787*s+16/116,l=l>.008856?Math.pow(l,1/3):7.787*l+16/116,e=116*s-16,r=500*(o-s),n=200*(s-l),[e,r,n]},i.hsl.rgb=function(t){var e,r,n,i,a,o=t[0]/360,s=t[1]/100,l=t[2]/100;if(0===s)return a=255*l,[a,a,a];e=2*l-(r=l<.5?l*(1+s):l+s-l*s),i=[0,0,0];for(var h=0;h<3;h++)(n=o+1/3*-(h-1))<0&&n++,n>1&&n--,a=6*n<1?e+6*(r-e)*n:2*n<1?r:3*n<2?e+(r-e)*(2/3-n)*6:e,i[h]=255*a;return i},i.hsl.hsv=function(t){var e,r,n=t[0],i=t[1]/100,a=t[2]/100,o=i,s=Math.max(a,.01);return a*=2,i*=a<=1?a:2-a,o*=s<=1?s:2-s,r=(a+i)/2,e=0===a?2*o/(s+o):2*i/(a+i),[n,100*e,100*r]},i.hsv.rgb=function(t){var e=t[0]/60,r=t[1]/100,n=t[2]/100,i=Math.floor(e)%6,a=e-Math.floor(e),o=255*n*(1-r),s=255*n*(1-r*a),l=255*n*(1-r*(1-a));switch(n*=255,i){case 0:return[n,l,o];case 1:return[s,n,o];case 2:return[o,n,l];case 3:return[o,s,n];case 4:return[l,o,n];case 5:return[n,o,s]}},i.hsv.hsl=function(t){var e,r,n,i=t[0],a=t[1]/100,o=t[2]/100,s=Math.max(o,.01);return n=(2-a)*o,e=(2-a)*s,r=a*s,r/=e<=1?e:2-e,r=r||0,n/=2,[i,100*r,100*n]},i.hwb.rgb=function(t){var e,r,n,i,a=t[0]/360,o=t[1]/100,s=t[2]/100,l=o+s;l>1&&(o/=l,s/=l),r=1-s,n=6*a-(e=Math.floor(6*a)),0!=(1&e)&&(n=1-n),i=o+n*(r-o);var h,u,f;switch(e){default:case 6:case 0:h=r,u=i,f=o;break;case 1:h=i,u=r,f=o;break;case 2:h=o,u=r,f=i;break;case 3:h=o,u=i,f=r;break;case 4:h=i,u=o,f=r;break;case 5:h=r,u=o,f=i}return[255*h,255*u,255*f]},i.cmyk.rgb=function(t){var e,r,n,i=t[0]/100,a=t[1]/100,o=t[2]/100,s=t[3]/100;return e=1-Math.min(1,i*(1-s)+s),r=1-Math.min(1,a*(1-s)+s),n=1-Math.min(1,o*(1-s)+s),[255*e,255*r,255*n]},i.xyz.rgb=function(t){var e,r,n,i=t[0]/100,a=t[1]/100,o=t[2]/100;return e=3.2406*i+-1.5372*a+-.4986*o,r=-.9689*i+1.8758*a+.0415*o,n=.0557*i+-.204*a+1.057*o,e=e>.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:12.92*r,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,e=Math.min(Math.max(0,e),1),r=Math.min(Math.max(0,r),1),n=Math.min(Math.max(0,n),1),[255*e,255*r,255*n]},i.xyz.lab=function(t){var e,r,n,i=t[0],a=t[1],o=t[2];return i/=95.047,a/=100,o/=108.883,i=i>.008856?Math.pow(i,1/3):7.787*i+16/116,a=a>.008856?Math.pow(a,1/3):7.787*a+16/116,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,e=116*a-16,r=500*(i-a),n=200*(a-o),[e,r,n]},i.lab.xyz=function(t){var e,r,n,i=t[0];e=t[1]/500+(r=(i+16)/116),n=r-t[2]/200;var a=Math.pow(r,3),o=Math.pow(e,3),s=Math.pow(n,3);return r=a>.008856?a:(r-16/116)/7.787,e=o>.008856?o:(e-16/116)/7.787,n=s>.008856?s:(n-16/116)/7.787,e*=95.047,r*=100,n*=108.883,[e,r,n]},i.lab.lch=function(t){var e,r,n,i=t[0],a=t[1],o=t[2];return e=Math.atan2(o,a),(r=360*e/2/Math.PI)<0&&(r+=360),n=Math.sqrt(a*a+o*o),[i,n,r]},i.lch.lab=function(t){var e,r,n,i=t[0],a=t[1];return n=t[2]/360*2*Math.PI,e=a*Math.cos(n),r=a*Math.sin(n),[i,e,r]},i.rgb.ansi16=function(t){var e=t[0],r=t[1],n=t[2],a=1 in arguments?arguments[1]:i.rgb.hsv(t)[2];if(0===(a=Math.round(a/50)))return 30;var o=30+(Math.round(n/255)<<2|Math.round(r/255)<<1|Math.round(e/255));return 2===a&&(o+=60),o},i.hsv.ansi16=function(t){return i.rgb.ansi16(i.hsv.rgb(t),t[2])},i.rgb.ansi256=function(t){var e=t[0],r=t[1],n=t[2];return e===r&&r===n?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(r/255*5)+Math.round(n/255*5)},i.ansi16.rgb=function(t){var e=t%10;if(0===e||7===e)return t>50&&(e+=3.5),e=e/10.5*255,[e,e,e];var r=.5*(1+~~(t>50));return[(1&e)*r*255,(e>>1&1)*r*255,(e>>2&1)*r*255]},i.ansi256.rgb=function(t){if(t>=232){var e=10*(t-232)+8;return[e,e,e]}t-=16;var r;return[Math.floor(t/36)/5*255,Math.floor((r=t%36)/6)/5*255,r%6/5*255]},i.rgb.hex=function(t){var e=(((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2]))).toString(16).toUpperCase();return"000000".substring(e.length)+e},i.hex.rgb=function(t){var e=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!e)return[0,0,0];var r=e[0];3===e[0].length&&(r=r.split("").map(function(t){return t+t}).join(""));var n=parseInt(r,16);return[n>>16&255,n>>8&255,255&n]},i.rgb.hcg=function(t){var e,r,n=t[0]/255,i=t[1]/255,a=t[2]/255,o=Math.max(Math.max(n,i),a),s=Math.min(Math.min(n,i),a),l=o-s;return e=l<1?s/(1-l):0,r=l<=0?0:o===n?(i-a)/l%6:o===i?2+(a-n)/l:4+(n-i)/l+4,r/=6,r%=1,[360*r,100*l,100*e]},i.hsl.hcg=function(t){var e=t[1]/100,r=t[2]/100,n=1,i=0;return(n=r<.5?2*e*r:2*e*(1-r))<1&&(i=(r-.5*n)/(1-n)),[t[0],100*n,100*i]},i.hsv.hcg=function(t){var e=t[1]/100,r=t[2]/100,n=e*r,i=0;return n<1&&(i=(r-n)/(1-n)),[t[0],100*n,100*i]},i.hcg.rgb=function(t){var e=t[0]/360,r=t[1]/100,n=t[2]/100;if(0===r)return[255*n,255*n,255*n];var i=[0,0,0],a=e%1*6,o=a%1,s=1-o,l=0;switch(Math.floor(a)){case 0:i[0]=1,i[1]=o,i[2]=0;break;case 1:i[0]=s,i[1]=1,i[2]=0;break;case 2:i[0]=0,i[1]=1,i[2]=o;break;case 3:i[0]=0,i[1]=s,i[2]=1;break;case 4:i[0]=o,i[1]=0,i[2]=1;break;default:i[0]=1,i[1]=0,i[2]=s}return l=(1-r)*n,[255*(r*i[0]+l),255*(r*i[1]+l),255*(r*i[2]+l)]},i.hcg.hsv=function(t){var e=t[1]/100,r=e+t[2]/100*(1-e),n=0;return r>0&&(n=e/r),[t[0],100*n,100*r]},i.hcg.hsl=function(t){var e=t[1]/100,r=t[2]/100*(1-e)+.5*e,n=0;return r>0&&r<.5?n=e/(2*r):r>=.5&&r<1&&(n=e/(2*(1-r))),[t[0],100*n,100*r]},i.hcg.hwb=function(t){var e=t[1]/100,r=e+t[2]/100*(1-e);return[t[0],100*(r-e),100*(1-r)]},i.hwb.hcg=function(t){var e=t[1]/100,r=1-t[2]/100,n=r-e,i=0;return n<1&&(i=(r-n)/(1-n)),[t[0],100*n,100*i]},i.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},i.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},i.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},i.gray.hsl=i.gray.hsv=function(t){return[0,0,t[0]]},i.gray.hwb=function(t){return[0,100,t[0]]},i.gray.cmyk=function(t){return[0,0,0,t[0]]},i.gray.lab=function(t){return[t[0],0,0]},i.gray.hex=function(t){var e=255&Math.round(t[0]/100*255),r=((e<<16)+(e<<8)+e).toString(16).toUpperCase();return"000000".substring(r.length)+r},i.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]}}),Gt=Object.keys(Ht),Jt=function(t){for(var e=at(t),r={},n=Object.keys(e),i=n.length,a=0;a<i;a++){var o=n[a];null!==e[o].parent&&(r[o]=st(o,e))}return r},Xt={};Object.keys(Ht).forEach(function(t){Xt[t]={},Object.defineProperty(Xt[t],"channels",{value:Ht[t].channels}),Object.defineProperty(Xt[t],"labels",{value:Ht[t].labels});var e=Jt(t);Object.keys(e).forEach(function(r){var n=e[r];Xt[t][r]=ht(n),Xt[t][r].raw=lt(n)})});var Kt=Xt,$t={getRgba:ut,getHsla:ft,getRgb:function(t){var e=ut(t);return e&&e.slice(0,3)},getHsl:function(t){var e=ft(t);return e&&e.slice(0,3)},getHwb:ct,getAlpha:function(t){var e=ut(t);return e?e[3]:(e=ft(t))?e[3]:(e=ct(t))?e[3]:void 0},hexString:function(t){return"#"+dt(t[0])+dt(t[1])+dt(t[2])},rgbString:function(t,e){return e<1||t[3]&&t[3]<1?pt(t,e):"rgb("+t[0]+", "+t[1]+", "+t[2]+")"},rgbaString:pt,percentString:function(t,e){return e<1||t[3]&&t[3]<1?vt(t,e):"rgb("+Math.round(t[0]/255*100)+"%, "+Math.round(t[1]/255*100)+"%, "+Math.round(t[2]/255*100)+"%)"},percentaString:vt,hslString:function(t,e){return e<1||t[3]&&t[3]<1?yt(t,e):"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)"},hslaString:yt,hwbString:function(t,e){return void 0===e&&(e=void 0!==t[3]?t[3]:1),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+(void 0!==e&&1!==e?", "+e:"")+")"},keyword:function(t){return Qt[t.slice(0,3)]}},Qt={};for(var te in Wt)Qt[Wt[te]]=te;var ee=function t(e){if(e instanceof t)return e;if(!(this instanceof t))return new t(e);this.values={rgb:[0,0,0],hsl:[0,0,0],hsv:[0,0,0],hwb:[0,0,0],cmyk:[0,0,0,0],alpha:1};var r;if("string"==typeof e)if(r=$t.getRgba(e))this.setValues("rgb",r);else if(r=$t.getHsla(e))this.setValues("hsl",r);else{if(!(r=$t.getHwb(e)))throw new Error('Unable to parse color from string "'+e+'"');this.setValues("hwb",r)}else if("object"===(void 0===e?"undefined":_t(e)))if(void 0!==(r=e).r||void 0!==r.red)this.setValues("rgb",r);else if(void 0!==r.l||void 0!==r.lightness)this.setValues("hsl",r);else if(void 0!==r.v||void 0!==r.value)this.setValues("hsv",r);else if(void 0!==r.w||void 0!==r.whiteness)this.setValues("hwb",r);else{if(void 0===r.c&&void 0===r.cyan)throw new Error("Unable to parse color from object "+JSON.stringify(e));this.setValues("cmyk",r)}};(ee.prototype={rgb:function(){return this.setSpace("rgb",arguments)},hsl:function(){return this.setSpace("hsl",arguments)},hsv:function(){return this.setSpace("hsv",arguments)},hwb:function(){return this.setSpace("hwb",arguments)},cmyk:function(){return this.setSpace("cmyk",arguments)},rgbArray:function(){return this.values.rgb},hslArray:function(){return this.values.hsl},hsvArray:function(){return this.values.hsv},hwbArray:function(){return 1!==this.values.alpha?this.values.hwb.concat([this.values.alpha]):this.values.hwb},cmykArray:function(){return this.values.cmyk},rgbaArray:function(){return this.values.rgb.concat([this.values.alpha])},rgbaArrayNormalized:function(){for(var t=this.values.rgb,e=[],r=0;r<3;r++)e[r]=t[r]/255;return e.push(this.values.alpha),e},hslaArray:function(){return this.values.hsl.concat([this.values.alpha])},alpha:function(t){return void 0===t?this.values.alpha:(this.setValues("alpha",t),this)},red:function(t){return this.setChannel("rgb",0,t)},green:function(t){return this.setChannel("rgb",1,t)},blue:function(t){return this.setChannel("rgb",2,t)},hue:function(t){return t&&(t=(t%=360)<0?360+t:t),this.setChannel("hsl",0,t)},saturation:function(t){return this.setChannel("hsl",1,t)},lightness:function(t){return this.setChannel("hsl",2,t)},saturationv:function(t){return this.setChannel("hsv",1,t)},whiteness:function(t){return this.setChannel("hwb",1,t)},blackness:function(t){return this.setChannel("hwb",2,t)},value:function(t){return this.setChannel("hsv",2,t)},cyan:function(t){return this.setChannel("cmyk",0,t)},magenta:function(t){return this.setChannel("cmyk",1,t)},yellow:function(t){return this.setChannel("cmyk",2,t)},black:function(t){return this.setChannel("cmyk",3,t)},hexString:function(){return $t.hexString(this.values.rgb)},rgbString:function(){return $t.rgbString(this.values.rgb,this.values.alpha)},rgbaString:function(){return $t.rgbaString(this.values.rgb,this.values.alpha)},percentString:function(){return $t.percentString(this.values.rgb,this.values.alpha)},hslString:function(){return $t.hslString(this.values.hsl,this.values.alpha)},hslaString:function(){return $t.hslaString(this.values.hsl,this.values.alpha)},hwbString:function(){return $t.hwbString(this.values.hwb,this.values.alpha)},keyword:function(){return $t.keyword(this.values.rgb,this.values.alpha)},rgbNumber:function(){return this.values.rgb[0]<<16|this.values.rgb[1]<<8|this.values.rgb[2]},luminosity:function(){for(var t=this.values.rgb,e=[],r=0;r<t.length;r++){var n=t[r]/255;e[r]=n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4)}return.2126*e[0]+.7152*e[1]+.0722*e[2]},contrast:function(t){var e=this.luminosity(),r=t.luminosity();return e>r?(e+.05)/(r+.05):(r+.05)/(e+.05)},level:function(t){var e=this.contrast(t);return e>=7.1?"AAA":e>=4.5?"AA":""},dark:function(){var t=this.values.rgb;return(299*t[0]+587*t[1]+114*t[2])/1e3<128},light:function(){return!this.dark()},negate:function(){for(var t=[],e=0;e<3;e++)t[e]=255-this.values.rgb[e];return this.setValues("rgb",t),this},lighten:function(t){return this.values.hsl[2]+=this.values.hsl[2]*t,this.setValues("hsl",this.values.hsl),this},darken:function(t){return this.values.hsl[2]-=this.values.hsl[2]*t,this.setValues("hsl",this.values.hsl),this},saturate:function(t){return this.values.hsl[1]+=this.values.hsl[1]*t,this.setValues("hsl",this.values.hsl),this},desaturate:function(t){return this.values.hsl[1]-=this.values.hsl[1]*t,this.setValues("hsl",this.values.hsl),this},whiten:function(t){return this.values.hwb[1]+=this.values.hwb[1]*t,this.setValues("hwb",this.values.hwb),this},blacken:function(t){return this.values.hwb[2]+=this.values.hwb[2]*t,this.setValues("hwb",this.values.hwb),this},greyscale:function(){var t=this.values.rgb,e=.3*t[0]+.59*t[1]+.11*t[2];return this.setValues("rgb",[e,e,e]),this},clearer:function(t){return this.setValues("alpha",this.values.alpha-this.values.alpha*t),this},opaquer:function(t){return this.setValues("alpha",this.values.alpha+this.values.alpha*t),this},rotate:function(t){var e=this.values.hsl[0];return e=(e+t)%360,e=e<0?360+e:e,this.values.hsl[0]=e,this.setValues("hsl",this.values.hsl),this},mix:function(t,e){var r=this,n=t,i=void 0===e?.5:e,a=2*i-1,o=r.alpha()-n.alpha(),s=((a*o==-1?a:(a+o)/(1+a*o))+1)/2,l=1-s;return this.rgb(s*r.red()+l*n.red(),s*r.green()+l*n.green(),s*r.blue()+l*n.blue()).alpha(r.alpha()*i+n.alpha()*(1-i))},toJSON:function(){return this.rgb()},clone:function(){var t=new ee;return t.values=qt(this.values),t}}).getValues=function(t){for(var e={},r=0;r<t.length;r++)e[t.charAt(r)]=this.values[t][r];return 1!==this.values.alpha&&(e.a=this.values.alpha),e},ee.prototype.setValues=function(t,e){var r,n={rgb:["red","green","blue"],hsl:["hue","saturation","lightness"],hsv:["hue","saturation","value"],hwb:["hue","whiteness","blackness"],cmyk:["cyan","magenta","yellow","black"]},i={rgb:[255,255,255],hsl:[360,100,100],hsv:[360,100,100],hwb:[360,100,100],cmyk:[100,100,100,100]},a=1;if("alpha"===t)a=e;else if(e.length)this.values[t]=e.slice(0,t.length),a=e[t.length];else if(void 0!==e[t.charAt(0)]){for(r=0;r<t.length;r++)this.values[t][r]=e[t.charAt(r)];a=e.a}else if(void 0!==e[n[t][0]]){var o=n[t];for(r=0;r<t.length;r++)this.values[t][r]=e[o[r]];a=e.alpha}if(this.values.alpha=Math.max(0,Math.min(1,void 0===a?this.values.alpha:a)),"alpha"===t)return!1;var s;for(r=0;r<t.length;r++)s=Math.max(0,Math.min(i[t][r],this.values[t][r])),this.values[t][r]=Math.round(s);for(var l in n)for(l!==t&&(this.values[l]=Kt[t][l](this.values[t])),r=0;r<l.length;r++)s=Math.max(0,Math.min(i[l][r],this.values[l][r])),this.values[l][r]=Math.round(s);return!0},ee.prototype.setSpace=function(t,e){var r=e[0];return void 0===r?this.getValues(t):("number"==typeof r&&(r=Array.prototype.slice.call(e)),this.setValues(t,r),this)},ee.prototype.setChannel=function(t,e,r){return void 0===r?this.values[t][e]:r===this.values[t][e]?this:(this.values[t][e]=r,this.setValues(t,this.values[t]),this)};var re=ee,ne=function(t){function r(e){xt(this,r);var n=bt(this,t.call(this,e));return n._needCheckStyle=!0,n._needCheckSprites=!0,n._registerEvents(),n}return mt(r,t),r.prototype.checkResources=function(){if(!this._needCheckStyle)return[];var t=[];return this.layer._cookedStyles&&this.layer._cookedStyles.forEach(function(r){r.symbol=e.Util.convertResourceUrl(r.symbol);var n=e.Util.getExternalResources(r.symbol,!0);n&&t.push(n)}),this._needCheckStyle=!1,this._needCheckSprites=!0,this._textureLoaded=!1,0===t.length?[]:t},r.prototype.onContextCreate=function(){this.gl.getExtension("OES_element_index_uint")},r.prototype.onRemove=function(){this._removeEvents(),delete this._fillSprites,delete this._sprites,t.prototype.onRemove.apply(this,arguments)},r.prototype.getDataSymbol=function(t){for(var e=-1,r=0,n=this.layer._cookedStyles.length;r<n;r++){var i=this.layer._cookedStyles[r],a=this.getTexture(i.symbol);if(a&&e++,!0===i.filter({properties:t}))return a?{symbol:i.symbol,texCoord:this._fillSprites.texCoords[e],index:r}:{symbol:i.symbol,index:r}}return null},r.prototype.getLineTexture=function(t){return this._atlas.getAtlas(t)},r.prototype.getFillTexture=function(t){var e=t?t.polygonPatternFile:null;return e?this.resources.getImage(e):null},r.prototype._checkSprites=function(){var t=this;if(this._needCheckSprites){this._atlas=new Et(this.resources);var r=[],n=[];if(this.layer._cookedStyles&&this.layer._cookedStyles.forEach(function(i){var a=t.getLineTexture(i.symbol);a&&r.push(a),(a=t.getFillTexture(i.symbol))&&n.push({canvas:a,offset:new e.Point(0,0)})}),this._sprites=this.mergeSprites(r),this._fillSprites=this.mergeSprites(n),this._sprites&&"undefined"!=typeof window&&window.MAPTALKS_WEBGL_DEBUG_CANVAS){var i=window.MAPTALKS_WEBGL_DEBUG_CANVAS;i.getContext("2d").fillRect(0,0,i.width,i.height),i.getContext("2d").fillStyle="rgb(255, 255, 255)",i.getContext("2d").fillRect(0,0,this._sprites.canvas.width,this._sprites.canvas.height),i.getContext("2d").drawImage(this._sprites.canvas,0,0)}this._needCheckSprites=!1,this._sprites&&!this._textureLoaded&&(this.loadTexture(this._sprites.canvas),this.enableSampler("u_image"),this._textureLoaded=!0),this._fillSprites&&!this._fillTextureLoaded&&(this.loadTexture(this._fillSprites.canvas),this.enableSampler("u_fill_image"),this._fillTextureLoaded=!0);for(var a=0,o=this._uStyle=[],s=0,l=this.layer._cookedStyles.length;s<l;s++){var h=this.layer._cookedStyles[s];if(this.getLineTexture(h.symbol))o.push.apply(o,this._sprites.texCoords[a++]),o.push(-1);else{var u=h.symbol.lineColor||"#000000";u=re(u).rgbaArrayNormalized(),o.push.apply(o,u)}}a=0;for(var f=this._uFillStyle=[],c=0,p=this.layer._cookedStyles.length;c<p;c++){var v=this.layer._cookedStyles[c];if(this.getFillTexture(v.symbol))f.push.apply(f,this._fillSprites.texCoords[a++]),f.push(-1);else{var y=v.symbol.polygonFill||"#fff";y=re(y).rgbaArrayNormalized(),f.push.apply(f,y)}}}},r.prototype._registerEvents=function(){this.layer.on("setstyle",this._onStyleChanged,this)},r.prototype._removeEvents=function(){this.layer.off("setstyle",this._onStyleChanged,this)},r.prototype._onStyleChanged=function(){this._needCheckStyle=!0},r}(St),ie={blur:2},ae=function(t){function e(){return xt(this,e),bt(this,t.apply(this,arguments))}return mt(e,t),e}(It);ae.mergeOptions(ie),ae.registerJSONType("BigLineLayer");var oe=function(t){function e(){return xt(this,e),bt(this,t.apply(this,arguments))}return mt(e,t),e.prototype.onContextCreate=function(){var e=["u_matrix","u_scale","u_tex_size","u_styles[0]"];this._lineProgram=this.createProgram(Pt.line.vertexSource,Pt.line.fragmentSource,e),t.prototype.onContextCreate.call(this)},e.prototype.draw=function(){this.prepareCanvas(),this._drawLines(),this.completeRender()},e.prototype.drawOnInteracting=function(){this._drawLines(),this.completeRender()},e.prototype.onRemove=function(){delete this._lineArrays,t.prototype.onRemove.apply(this,arguments)},e.prototype.getTexture=function(t){return this.getLineTexture(t)},e.prototype._drawLines=function(){var t=this.gl,e=this.getMap(),r=this._lineProgram;this.useProgram(r),this._checkSprites(),this._prepareLineData(),this._bufferLineData(this._lineArrays);var n=this.calcMatrices();t.uniformMatrix4fv(t.program.u_matrix,!1,n),t.uniform1f(r.u_scale,e.getScale()/e.getScale(d(e))),t.uniform1fv(r.u_styles,this._uStyle);var i=[0,0];this._sprites&&(i=[this._sprites.canvas.width,this._sprites.canvas.height]),t.uniform2fv(r.u_tex_size,new Float32Array(i)),t.drawElements(t.TRIANGLES,this._elementCount,t.UNSIGNED_INT,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)},e.prototype._prepareLineData=function(){if(!this._lineArrays){for(var t=this.gl,e=this.getMap(),r=this.layer.data,n=new Ct(t,e),i=void 0,a=0,o=r.length;a<o;a++)r[a]&&(Array.isArray(r[a])?(i=this.getDataSymbol(r[a][1]),n.addLine(r[a][0],i)):r[a].type&&(i=this.getDataSymbol(r[a].properties),n.addLine(r[a],i)));var s=this._lineArrays=n.getArrays();this._elementCount=s.elementArray.length}},e.prototype._bufferLineData=function(t){var e=this.gl;if(this._vertexBuffer)e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer);else{var r=this._vertexBuffer=this.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t.vertexArray),e.STATIC_DRAW)}if(this.enableVertexAttrib(["a_pos",2,"FLOAT"]),this._normalBuffer)e.bindBuffer(e.ARRAY_BUFFER,this._normalBuffer);else{var n=this._normalBuffer=this.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t.normalArray),e.STATIC_DRAW)}if(this.enableVertexAttrib([["a_normal",2,"FLOAT"],["a_linesofar",1,"FLOAT"]]),this._texBuffer)e.bindBuffer(e.ARRAY_BUFFER,this._texBuffer);else{var i=this._texBuffer=this.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t.styleArray),e.STATIC_DRAW)}if(this.enableVertexAttrib([["a_style",1,"FLOAT"]]),e.bindBuffer(e.ARRAY_BUFFER,null),this._elementBuffer)e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._elementBuffer);else{var a=this._elementBuffer=this.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint32Array(t.elementArray),e.STATIC_DRAW)}},e}(ne);ae.registerRenderer("webgl",oe);var se={blur:2},le=function(t){function e(){return xt(this,e),bt(this,t.apply(this,arguments))}return mt(e,t),e}(It);le.mergeOptions(se),le.registerJSONType("BigPolygonLayer"),le.registerRenderer("webgl",function(t){function e(){return xt(this,e),bt(this,t.apply(this,arguments))}return mt(e,t),e.prototype.onContextCreate=function(){var e=["u_matrix","u_fill_styles[0]"];this._polygonProgram=this.createProgram(Pt.polygon.vertexSource,Pt.polygon.fragmentSource,e),t.prototype.onContextCreate.call(this)},e.prototype.draw=function(){this.prepareCanvas(),this._drawPolygons(),this.gl.disable(this.gl.BLEND),this._drawLines(),this.gl.enable(this.gl.BLEND),this.completeRender()},e.prototype.drawOnInteracting=function(){this._drawPolygons(),this.gl.disable(this.gl.BLEND),this._drawLines(),this.gl.enable(this.gl.BLEND),this.completeRender()},e.prototype.getTexture=function(t){return this.getFillTexture(t)},e.prototype._drawPolygons=function(){var t=this.gl,e=this._polygonProgram;this.useProgram(e),this._checkSprites(),this._preparePolygonData(),this._bufferPolygonData(this._polygonArrays);var r=this.calcMatrices();t.uniformMatrix4fv(t.program.u_matrix,!1,r),t.uniform1fv(e.u_fill_styles,this._uFillStyle),t.drawElements(t.TRIANGLES,this._polygonElementCount,t.UNSIGNED_INT,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)},e.prototype._preparePolygonData=function(){if(!this._polygonArrays){for(var t=this.gl,e=this.getMap(),r=this.layer.data,n=new Tt(t,e),i=void 0,a=0,o=r.length;a<o;a++)r[a]&&(Array.isArray(r[a])?(i=this.getDataSymbol(r[a][1]),n.addPolygon(r[a][0],i)):r[a].type&&(i=this.getDataSymbol(r[a].properties),n.addPolygon(r[a],i)));var s=this._polygonArrays=n.getArrays();this._polygonElementCount=s.elementArray.length}},e.prototype._bufferPolygonData=function(t){var e=this.gl;if(this._polygonVertexBuffer)e.bindBuffer(e.ARRAY_BUFFER,this._polygonVertexBuffer);else{var r=this._polygonVertexBuffer=this.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t.vertexArray),e.STATIC_DRAW)}if(this.enableVertexAttrib(["a_pos",2,"FLOAT"]),this._polygonTexBuffer)e.bindBuffer(e.ARRAY_BUFFER,this._polygonTexBuffer);else{var n=this._polygonTexBuffer=this.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t.styleArray),e.STATIC_DRAW)}if(this.enableVertexAttrib([["a_fill_style",1,"FLOAT"]]),e.bindBuffer(e.ARRAY_BUFFER,null),this._polygonElemBuffer)e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._polygonElemBuffer);else{var i=this._polygonElemBuffer=this.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint32Array(t.elementArray),e.STATIC_DRAW)}},e.prototype.onRemove=function(){delete this._polygonArrays,t.prototype.onRemove.apply(this,arguments)},e}(oe));var he={project:!0},ue=function(t){function r(e,n,i){xt(this,r);var a=bt(this,t.call(this,e,n,i));return a.vertexArray=[],a.normalArray=[],a.elementArray=[],a.styleArray=[],a}return mt(r,t),r.prototype.getArrays=function(){return{vertexArray:this.vertexArray,normalArray:this.normalArray,elementArray:this.elementArray,styleArray:this.styleArray}},r.prototype.addPolygon=function(t,e,r){if(!t)return this;if(r.symbol.polygonOpacity<=0)return this;var n=this._getVertice(t);if(n[0]&&Array.isArray(n[0][0])&&Array.isArray(n[0][0][0])){for(var i=0,a=n.length;i<a;i++)this.addPolygon(n[i],e,r);return this}return this._fillArrays(n,e,r),this},r.prototype._fillArrays=function(t,r,n){for(var i=d(this.map),a=Ft.flatten(t),o=[],s=[],l=void 0,h=0,u=a.vertices.length;h<u;h+=2)h===u-1&&this._equalCoord(a.vertices[h],a.vertices[0])||(this.options.project?(l=this.map.coordinateToPoint(new e.Coordinate(a.vertices[h],a.vertices[h+1]),i),o.push(l.x,l.y,0),s.push(l.x,l.y,r)):(o.push(a.vertices[h],a.vertices[h+1],0),s.push(a.vertices[h],a.vertices[h+1],r)));a.vertices=o;var f=Ft(a.vertices,a.holes,3);if(!(f.length<=2)){var c=Ft.deviation(a.vertices,a.holes,3,f);if(Math.round(1e3*c)/1e3==0){var p=o.length/3,v=this.vertexArray.length/3;v>0&&(f=f.map(function(t){return t+v})),e.Util.pushIn(this.vertexArray,o),e.Util.pushIn(this.elementArray,f);for(var y=0;y<p;y++)this.normalArray.push(0,0,-1);p>0&&(f=f.map(function(t){return t+p})),e.Util.pushIn(this.vertexArray,s),e.Util.pushIn(this.elementArray,f);for(var g=0;g<p;g++)this.normalArray.push(0,0,1);for(var _=this.vertexArray.length/3,x=0,m=p;x<m-1;x++){var b=3*x,A=new Mt(o[b+3],o[b+4]).sub(new Mt(o[b],o[b+1]))._unit()._perp();this.vertexArray.push(o[b],o[b+1],o[b+2]),this.vertexArray.push(o[b+3],o[b+4],o[b+5]),this.vertexArray.push(s[b+3],s[b+4],s[b+5]),this.vertexArray.push(s[b],s[b+1],s[b+2]);for(var w=0;w<4;w++)this.normalArray.push(A.x,A.y,0);var S=4*x;this.elementArray.push(_+S,_+S+1,_+S+2),this.elementArray.push(_+S,_+S+2,_+S+3)}this._addTexCoords(this.vertexArray.length/3-v,n)}else console&&console.warn("Failed triangluation.")}},r.prototype._getVertice=function(t){return t.geometry?t=t.geometry.coordinates:t.coordinates&&(t=t.coordinates),t},r.prototype._addTexCoords=function(t,e){for(var r=100*e.index+10*(e.symbol.polygonOpacity||1),n=0;n<t;n++)this.styleArray.push(r)},r.prototype._equalCoord=function(t,e){return t[0]===e[0]&&t[1]===e[1]},r}(At);ue.mergeOptions(he);var fe={lightPos:[10,0,35],lightColor:[1,1,1],lightIntensity:.5,ambientLight:[.02,.02,.02]},ce=function(t){function e(){return xt(this,e),bt(this,t.apply(this,arguments))}return mt(e,t),e}(It);ce.mergeOptions(fe),ce.registerJSONType("ExtrudePolygonLayer");var pe=function(t){function e(){return xt(this,e),bt(this,t.apply(this,arguments))}return mt(e,t),e.prototype.onContextCreate=function(){var e=["u_matrix","u_fill_styles[0]","u_lightcolor","u_lightpos","u_ambientlight","u_lightintensity"];this.program=this.createProgram(Pt.extrude.vertexSource,Pt.extrude.fragmentSource,e),t.prototype.onContextCreate.call(this);var r=this.gl;r.enable(r.DEPTH_TEST),r.disable(r.BLEND),r.disable(r.STENCIL_TEST),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1)},e.prototype.draw=function(){this.prepareCanvas(),this._drawExtrudes(),this.completeRender()},e.prototype.drawOnInteracting=function(){this._drawExtrudes(),this.completeRender()},e.prototype.onRemove=function(){delete this._extrudeArrays,t.prototype.onRemove.apply(this,arguments)},e.prototype.getTexture=function(t){return this.getFillTexture(t)},e.prototype._drawExtrudes=function(){var t=this.gl,e=this.program;this.useProgram(e),this._checkSprites(),this._prepareData();var r=this.calcMatrices();t.uniformMatrix4fv(t.program.u_matrix,!1,r),t.uniform1fv(e.u_fill_styles,this._uFillStyle);var n=this.layer.options.lightPos||[0,0,35];t.uniform3fv(t.program.u_lightpos,v([],n));var i=this.layer.options.lightColor||[1,1,1];t.uniform3f(t.program.u_lightcolor,i[0],i[1],i[2]);var a=this.layer.options.ambientLight||[.02,.02,.02];t.uniform3f(t.program.u_ambientlight,a[0],a[1],a[2]);var o=this.layer.options.lightIntensity||.5;t.uniform1f(t.program.u_lightintensity,o),this._bufferExtrudeData(this._extrudeArrays),t.drawElements(t.TRIANGLES,this._elementCount,t.UNSIGNED_INT,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)},e.prototype._prepareData=function(){if(!this._extrudeArrays){for(var t=this.gl,e=this.getMap(),r=d(e),n=this.layer.data,i=new ue(t,e),a=0,o=n.length;a<o;a++)if(n[a])if(Array.isArray(n[a])){var s=this.getDataSymbol(n[a][1]),l=n[a][1].height,h=e.distanceToPixel(l,0,r).width;i.addPolygon(n[a][0],h,s)}else if(n[a].type){var u=this.getDataSymbol(n[a].properties),f=n[a].properties.height,c=e.distanceToPixel(f,0,r).width;i.addPolygon(n[a],c,u)}var p=this._extrudeArrays=i.getArrays();this._elementCount=p.elementArray.length}},e.prototype._bufferExtrudeData=function(t){var e=this.gl;if(this._vertexBuffer)e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer);else{var r=this._vertexBuffer=this.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t.vertexArray),e.STATIC_DRAW)}if(this.enableVertexAttrib(["a_pos",3,"FLOAT"]),this._normalBuffer)e.bindBuffer(e.ARRAY_BUFFER,this._normalBuffer);else{var n=this._normalBuffer=this.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t.normalArray),e.STATIC_DRAW)}if(this.enableVertexAttrib(["a_normal",3,"FLOAT"]),this._texBuffer)e.bindBuffer(e.ARRAY_BUFFER,this._texBuffer);else{var i=this._texBuffer=this.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t.styleArray),e.STATIC_DRAW)}if(this.enableVertexAttrib([["a_fill_style",1,"FLOAT"]]),e.bindBuffer(e.ARRAY_BUFFER,null),this._elementBuffer)e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._elementBuffer);else{var a=this._elementBuffer=this.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint32Array(t.elementArray),e.STATIC_DRAW)}},e}(ne);ce.registerRenderer("webgl",pe),t.webgl=Ut,t.BigDataLayer=It,t.BigPointLayer=Zt,t.BigLineLayer=ae,t.BigPolygonLayer=le,t.ExtrudePolygonLayer=ce,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.biglayer v0.4.0, requires maptalks@>=0.37.0.")});